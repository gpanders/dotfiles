# Greg Anders (gpanders)'s muttrc <https://github.com/gpanders/dotfiles.git>

set from = "greg@gpanders.com"
set mbox_type = Maildir
set folder = "~/.mail"
set spoolfile = +INBOX
set postponed = +Drafts
set record = +Sent
set mbox = +Archive
set trash = +Trash
source ~/.config/mutt/mailboxes

set mailcap_path = ~/.config/mutt/mailcap
alternative_order text/plain text/enriched text/html
auto_view text/html

set realname = "Greg Anders"
set editor = `echo \$EDITOR`
set use_from = yes
set use_envelope_from = yes
set sendmail = msmtp
set edit_headers = yes
set text_flowed
set sort = threads
set sort_aux = reverse-last-date-received
set pager_index_lines = 10

set alias_file = ~/.config/mutt/aliases
set sort_alias = alias
set reverse_alias = yes
source $alias_file

# Mailing Lists
source ~/.config/mutt/lists

# Store message headers locally to speed things up.  If hcache is a folder,
# Mutt will create sub cache folders for each account which may speeds things
# up even more.
set header_cache = ~/.cache/mutt/headers

# Store messages locally to speed things up, like searching message bodies.
# Can be the same folder as header_cache.
# This will cost important disk usage according to your e-mail amount.
set message_cachedir = ~/.cache/mutt/messages

# Colorscheme
source ~/.config/mutt/colors/base16.muttrc

# Bindings

# g is group-reply by default, we'll map that to R instead
bind  index,pager g   noop
bind  index       gg  first-entry

# G is fetch-mail by default, since I use offlineimap I don't ever fetch mail
# from a pop server
bind  index       G   last-entry

bind  index,pager ]   next-undeleted
bind  index,pager [   previous-undeleted

# Navigate like vim
bind  index,pager \Cu previous-page
bind  index,pager \Cd next-page
bind  pager       j   next-line
bind  pager       k   previous-line
macro pager       gg  <top><refresh>
macro pager       G   <bottom><refresh>

# Bind R to group-reply
bind  index,pager R   group-reply

# For some reason the screen gets borked after closing a message and requires
# a redraw
macro pager       q   <exit><refresh>

# Set up notmuch virtual mailboxes
set virtual_spoolfile = yes
set vfolder_format = "  %f %?n?%4n new?"

set nm_default_uri = notmuch://`notmuch config get database.path`
set nm_record = yes
set nm_record_tags = "-inbox,-unread,+archive,+sent"
set nm_unread_tag = "unread"

macro index,pager c <change-vfolder>?
bind index,pager Y modify-labels
bind index,pager S vfolder-from-query

virtual-mailboxes "Inbox" "notmuch://?query=folder:INBOX"
virtual-mailboxes "Archive" "notmuch://?query=folder:Archive"
virtual-mailboxes "Sent" "notmuch://?query=folder:Sent"
virtual-mailboxes "Trash" "notmuch://?query=folder:Trash"

folder-hook "INBOX" 'macro index,pager A "<tag-prefix><modify-labels>-inbox +archive\n<save-message>=Archive\ny<sync-mailbox>" "Archive message"'
folder-hook "Archive" 'macro index,pager A "<tag-prefix><modify-labels>+inbox -archive\n<save-message>=INBOX\ny<sync-mailbox>y" "Unarchive message"'

# vim: syntax=neomuttrc
